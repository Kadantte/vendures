<vdr-page-block>
    <div class="widget-header mb-1">
        <vdr-dropdown>
            <button class="btn btn-secondary btn-sm" vdrDropdownTrigger>
                <ng-icon hlm name="lucidePlus"></ng-icon>
                {{ 'dashboard.add-widget' | translate }}
                <ng-icon hlm name="lucideEllipsisVertical"></ng-icon>
            </button>
            <vdr-dropdown-menu vdrPosition="bottom-right">
                <button
                    vdrDropdownItem
                    *ngFor="let widget of availableWidgets$ | async"
                    (click)="addWidget(widget.id)"
                >
                    {{ widget.config.title ?? widget.id | translate }}
                </button>
            </vdr-dropdown-menu>
        </vdr-dropdown>
    </div>
    <div cdkDropListGroup>
        <div
            class="dashboard-row grid grid-cols-12 gap-4"
            *ngFor="let row of widgetLayout; index as rowIndex; trackBy: trackRow"
            cdkDropList
            (cdkDropListDropped)="drop($event)"
            cdkDropListOrientation="horizontal"
            [cdkDropListData]="{ index: rowIndex }"
        >
            <div
                *ngFor="let widget of row; trackBy: trackRowItem"
                class="dashboard-item"
                [ngClass]="getClassForWidth(widget.width)"
                cdkDrag
                [cdkDragData]="widget"
            >
                <vdr-dashboard-widget
                    *vdrIfPermissions="widget.config.requiresPermissions || null"
                    [widgetConfig]="widget.config"
                >
                    <div class="flex">
                        <div class="drag-handle" cdkDragHandle>
                            <ng-icon hlm name="lucideGripHorizontal"></ng-icon>
                        </div>
                        <vdr-dropdown>
                            <button class="icon-button" vdrDropdownTrigger>
                                <ng-icon hlm name="lucideEllipsisVertical"></ng-icon>
                            </button>
                            <vdr-dropdown-menu vdrPosition="bottom-right">
                                <h4 class="dropdown-header">{{ 'dashboard.widget-resize' | translate }}</h4>
                                <button
                                    vdrDropdownItem
                                    [disabled]="width === widget.width"
                                    *ngFor="let width of getSupportedWidths(widget.config)"
                                    (click)="setWidgetWidth(widget, width)"
                                >
                                    {{ 'dashboard.widget-width' | translate: { width: width } }}
                                </button>
                                <div class="dropdown-divider" role="separator"></div>
                                <button vdrDropdownItem (click)="removeWidget(widget)">
                                    <ng-icon hlm name="lucideTrash" class="is-danger"></ng-icon>
                                    {{ 'dashboard.remove-widget' | translate }}
                                </button>
                            </vdr-dropdown-menu>
                        </vdr-dropdown>
                    </div>
                </vdr-dashboard-widget>
            </div>
        </div>
    </div>
</vdr-page-block>
